<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jump Legends</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
        }
        #game-container {
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <script>
        // Global game data
        const GameData = {
            selectedSkin: 'red_square',
            skins: {
                'red_square': { name: 'Classic Red', color: 0xFF0000, shape: 'square' },
                'blue_circle': { name: 'Blue Blob', color: 0x0000FF, shape: 'circle' },
                'green_square': { name: 'Green Machine', color: 0x00FF00, shape: 'square' },
                'yellow_triangle': { name: 'Yellow Arrow', color: 0xFFFF00, shape: 'triangle' },
                'purple_circle': { name: 'Purple Orb', color: 0xFF00FF, shape: 'circle' },
                'orange_square': { name: 'Orange Box', color: 0xFF8800, shape: 'square' },
                'cyan_circle': { name: 'Cyan Sphere', color: 0x00FFFF, shape: 'circle' },
                'pink_square': { name: 'Pink Cube', color: 0xFF69B4, shape: 'square' }
            }
        };

        // MENU SCENE
        class MenuScene extends Phaser.Scene {
            constructor() {
                super('MenuScene');
            }

            create() {
                // Background color
                this.cameras.main.setBackgroundColor('#87CEEB');

                // Title
                this.add.text(400, 100, 'JUMP LEGENDS', {
                    fontSize: '72px',
                    fill: '#FF0000',
                    fontStyle: 'bold',
                    stroke: '#000',
                    strokeThickness: 8
                }).setOrigin(0.5);

                // Subtitle
                this.add.text(400, 170, 'The Ultimate Jumping Adventure', {
                    fontSize: '24px',
                    fill: '#000',
                    fontStyle: 'italic'
                }).setOrigin(0.5);

                // Start Button
                const startButton = this.add.rectangle(400, 250, 200, 60, 0x00FF00);
                const startText = this.add.text(400, 250, 'START GAME', {
                    fontSize: '28px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                startButton.setInteractive({ useHandCursor: true });
                startButton.on('pointerover', () => { startButton.fillColor = 0x00DD00; });
                startButton.on('pointerout', () => { startButton.fillColor = 0x00FF00; });
                startButton.on('pointerdown', () => { this.scene.start('GameScene'); });

                // Skins Button
                const skinsButton = this.add.rectangle(400, 330, 200, 60, 0xFFAA00);
                const skinsText = this.add.text(400, 330, 'CHOOSE SKIN', {
                    fontSize: '28px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                skinsButton.setInteractive({ useHandCursor: true });
                skinsButton.on('pointerover', () => { skinsButton.fillColor = 0xFF8800; });
                skinsButton.on('pointerout', () => { skinsButton.fillColor = 0xFFAA00; });
                skinsButton.on('pointerdown', () => { this.scene.start('SkinsScene'); });

                // Instructions
                this.add.text(400, 420, 'HOW TO PLAY', {
                    fontSize: '20px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                this.add.text(400, 455, '← → Arrow Keys: Move', {
                    fontSize: '16px',
                    fill: '#000'
                }).setOrigin(0.5);

                this.add.text(400, 480, 'SPACE or CLICK: Jump', {
                    fontSize: '16px',
                    fill: '#000'
                }).setOrigin(0.5);

                this.add.text(400, 505, 'Double Jump Available!', {
                    fontSize: '16px',
                    fill: '#00FF00',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                this.add.text(400, 540, 'Avoid green obstacles!', {
                    fontSize: '14px',
                    fill: '#FF0000'
                }).setOrigin(0.5);

                // Current skin preview
                this.add.text(400, 575, 'Current Skin: ' + GameData.skins[GameData.selectedSkin].name, {
                    fontSize: '14px',
                    fill: '#666'
                }).setOrigin(0.5);

                // Space to start
                this.input.keyboard.once('keydown-SPACE', () => {
                    this.scene.start('GameScene');
                });
            }
        }

        // SKINS SELECTION SCENE
        class SkinsScene extends Phaser.Scene {
            constructor() {
                super('SkinsScene');
            }

            create() {
                this.cameras.main.setBackgroundColor('#87CEEB');

                // Title
                this.add.text(400, 50, 'CHOOSE YOUR SKIN', {
                    fontSize: '48px',
                    fill: '#000',
                    fontStyle: 'bold',
                    stroke: '#FFF',
                    strokeThickness: 4
                }).setOrigin(0.5);

                // Display skins in a grid
                const skinKeys = Object.keys(GameData.skins);
                const startX = 150;
                const startY = 150;
                const spacing = 150;

                skinKeys.forEach((skinKey, index) => {
                    const skin = GameData.skins[skinKey];
                    const col = index % 4;
                    const row = Math.floor(index / 4);
                    const x = startX + col * spacing;
                    const y = startY + row * spacing;

                    // Background box
                    const bg = this.add.rectangle(x, y, 120, 120, 0xFFFFFF, 0.3);

                    // Highlight if selected
                    if (skinKey === GameData.selectedSkin) {
                        const highlight = this.add.rectangle(x, y, 130, 130);
                        highlight.setStrokeStyle(4, 0xFFFF00);
                    }

                    // Draw the skin preview
                    let skinPreview;
                    if (skin.shape === 'square') {
                        skinPreview = this.add.rectangle(x, y - 15, 40, 40, skin.color);
                    } else if (skin.shape === 'circle') {
                        skinPreview = this.add.circle(x, y - 15, 20, skin.color);
                    } else if (skin.shape === 'triangle') {
                        skinPreview = this.add.triangle(x, y - 15, 0, 20, -20, -20, 20, -20, skin.color);
                    }

                    // Skin name
                    this.add.text(x, y + 25, skin.name, {
                        fontSize: '12px',
                        fill: '#000',
                        fontStyle: 'bold',
                        align: 'center',
                        wordWrap: { width: 110 }
                    }).setOrigin(0.5);

                    // Make clickable
                    bg.setInteractive({ useHandCursor: true });

                    bg.on('pointerover', () => {
                        bg.fillColor = 0xFFFFFF;
                        bg.alpha = 0.6;
                    });

                    bg.on('pointerout', () => {
                        bg.fillColor = 0xFFFFFF;
                        bg.alpha = 0.3;
                    });

                    bg.on('pointerdown', () => {
                        GameData.selectedSkin = skinKey;
                        this.scene.restart();
                    });
                });

                // Back button
                const backButton = this.add.rectangle(400, 520, 180, 50, 0xFF0000);
                const backText = this.add.text(400, 520, 'BACK TO MENU', {
                    fontSize: '24px',
                    fill: '#FFF',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                backButton.setInteractive({ useHandCursor: true });
                backButton.on('pointerover', () => { backButton.fillColor = 0xDD0000; });
                backButton.on('pointerout', () => { backButton.fillColor = 0xFF0000; });
                backButton.on('pointerdown', () => { this.scene.start('MenuScene'); });

                // ESC to go back
                this.input.keyboard.once('keydown-ESC', () => {
                    this.scene.start('MenuScene');
                });
            }
        }

        // GAME SCENE
        class GameScene extends Phaser.Scene {
            constructor() {
                super('GameScene');
            }

            create() {
                // Game state variables
                this.score = 0;
                this.lives = 5;
                this.playerSpeed = 300;
                this.canDoubleJump = true;
                this.hasDoubleJumped = false;
                this.isGameOver = false;

                // Set world bounds
                this.physics.world.setBounds(0, 0, 2000, 600);

                // Create ground
                this.ground = this.physics.add.staticGroup();
                for (let i = 0; i < 25; i++) {
                    const groundTile = this.add.rectangle(i * 80, 580, 80, 40, 0x8B4513);
                    this.ground.add(groundTile);
                }

                // Create player with selected skin
                const selectedSkin = GameData.skins[GameData.selectedSkin];
                if (selectedSkin.shape === 'square') {
                    this.player = this.add.rectangle(100, 500, 30, 30, selectedSkin.color);
                } else if (selectedSkin.shape === 'circle') {
                    this.player = this.add.circle(100, 500, 15, selectedSkin.color);
                } else if (selectedSkin.shape === 'triangle') {
                    this.player = this.add.triangle(100, 500, 0, 15, -15, -15, 15, -15, selectedSkin.color);
                }

                this.physics.add.existing(this.player);
                this.player.body.setCollideWorldBounds(true);

                // Store original color for flash effect
                this.playerOriginalColor = selectedSkin.color;

                // Create obstacles
                this.obstacles = this.physics.add.staticGroup();
                this.createObstacle(300);
                this.createObstacle(500);
                this.createObstacle(700);
                this.createObstacle(900);
                this.createObstacle(1200);
                this.createObstacle(1500);
                this.createObstacle(1800);

                // Collisions
                this.physics.add.collider(this.player, this.ground);
                this.physics.add.overlap(this.player, this.obstacles, this.hitObstacle, null, this);

                // Input
                this.cursors = this.input.keyboard.createCursorKeys();
                this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
                this.input.on('pointerdown', () => this.jump());

                // Camera follows player
                this.cameras.main.setBounds(0, 0, 2000, 600);
                this.cameras.main.startFollow(this.player);

                // UI
                this.scoreText = this.add.text(16, 16, 'Score: 0', {
                    fontSize: '24px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setScrollFactor(0);

                this.livesText = this.add.text(16, 50, 'Lives: 5', {
                    fontSize: '24px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setScrollFactor(0);

                this.add.text(16, 84, 'Skin: ' + selectedSkin.name, {
                    fontSize: '16px',
                    fill: '#666',
                    fontStyle: 'bold'
                }).setScrollFactor(0);

                this.add.text(400, 16, 'Use Arrow Keys to Move!', {
                    fontSize: '18px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setOrigin(0.5, 0).setScrollFactor(0);

                console.log('Game started with skin:', GameData.selectedSkin);
            }

            update() {
                if (this.isGameOver) return;

                // Score increases over time
                this.score += 1;
                this.scoreText.setText('Score: ' + Math.floor(this.score / 10));

                // Movement
                if (this.cursors.left.isDown) {
                    this.player.body.setVelocityX(-this.playerSpeed);
                } else if (this.cursors.right.isDown) {
                    this.player.body.setVelocityX(this.playerSpeed);
                } else {
                    this.player.body.setVelocityX(0);
                }

                // Jump
                if (Phaser.Input.Keyboard.JustDown(this.spaceKey)) {
                    this.jump();
                }

                // Reset double jump when on ground
                if (this.player.body.touching.down) {
                    this.hasDoubleJumped = false;
                }
            }

            jump() {
                if (this.isGameOver) return;

                // First jump
                if (this.player.body.touching.down) {
                    this.player.body.setVelocityY(-500);
                    this.hasDoubleJumped = false;
                }
                // Double jump
                else if (this.canDoubleJump && !this.hasDoubleJumped) {
                    this.player.body.setVelocityY(-450);
                    this.hasDoubleJumped = true;
                }
            }

            createObstacle(xPosition) {
                const height = Phaser.Math.Between(30, 60);
                const obstacle = this.add.rectangle(xPosition, 550 - height / 2, 30, height, 0x00FF00);
                this.obstacles.add(obstacle);
            }

            hitObstacle(player, obstacle) {
                obstacle.destroy();
                this.lives -= 1;
                this.livesText.setText('Lives: ' + this.lives);

                // Flash effect
                player.fillColor = 0xFFFFFF;
                this.time.delayedCall(100, () => {
                    if (!this.isGameOver) {
                        player.fillColor = this.playerOriginalColor;
                    }
                });

                if (this.lives <= 0) {
                    this.gameOver();
                }
            }

            gameOver() {
                this.isGameOver = true;
                this.physics.pause();
                this.player.fillColor = 0x666666;

                const finalScore = Math.floor(this.score / 10);

                this.add.text(400, 250, 'GAME OVER', {
                    fontSize: '64px',
                    fill: '#FF0000',
                    align: 'center',
                    fontStyle: 'bold',
                    stroke: '#000',
                    strokeThickness: 8
                }).setOrigin(0.5).setScrollFactor(0);

                this.add.text(400, 340, 'Final Score: ' + finalScore, {
                    fontSize: '32px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setOrigin(0.5).setScrollFactor(0);

                // Restart button
                const restartButton = this.add.rectangle(400, 420, 200, 60, 0x00FF00).setScrollFactor(0);
                const restartText = this.add.text(400, 420, 'PLAY AGAIN', {
                    fontSize: '28px',
                    fill: '#000',
                    fontStyle: 'bold'
                }).setOrigin(0.5).setScrollFactor(0);

                restartButton.setInteractive({ useHandCursor: true });
                restartButton.on('pointerover', () => { restartButton.fillColor = 0x00DD00; });
                restartButton.on('pointerout', () => { restartButton.fillColor = 0x00FF00; });
                restartButton.on('pointerdown', () => { this.scene.start('MenuScene'); });

                this.add.text(400, 500, 'Click button or press SPACE', {
                    fontSize: '16px',
                    fill: '#666'
                }).setOrigin(0.5).setScrollFactor(0);

                // Also allow space to restart
                this.input.keyboard.once('keydown-SPACE', () => {
                    this.scene.start('MenuScene');
                });
            }
        }

        // Game configuration
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#87CEEB',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 1000 },
                    debug: false
                }
            },
            scene: [MenuScene, SkinsScene, GameScene]
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>
